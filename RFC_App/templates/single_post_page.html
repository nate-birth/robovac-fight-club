{% extends 'base.html' %}
{% load static %}

{% block title %} 
Single Post Page
{% endblock %}

{% block content %}

<div class="container py-1">
    <div class="row mt-2">
        <div class="col-10 mx-auto my-4">
        </div>
        <div class="col-10 mx-auto my-1">
          <div>    
            <h1 class="product_title">{{post.title}}</h1>
            <p>{{post.author.first_name}} {{post.author.last_name}} - {{post.created_at}}</p>
            <p class="product_description">post body below</p>
            <p class="text-justify product_text">{{post.body}}</p>
          </div>
        </div> 
    </div>
</div>

<div class="container py-1">
    <div class="row mt-2">
        <div class="col-10 mx-auto my-4">
        </div>
        <div class="col-10 mx-auto my-1">
          <div id="comments">    
            {% for comment in post.post_comments.all %}
            <h5>user: {{comment.user.first_name}} {{comment.user.last_name}}</h5>
            <p>{{comment.comment}}</p>
            {% endfor %}
          </div>
        </div> 
    </div>
</div>

<div class="container py-1">
  <div class="row mt-2">
    <div class="col-10 mx-auto my-4">
    </div>
    <div class="col-10 mx-auto my-1">
      <div>    
            {% if request.user.is_authenticated %}
            <h2>add a comment</h2>
            <form id="SPPcomment" action="/add_comment" method="POST">
                {% csrf_token %}
                <input type="hidden" name="pid" value="{{post.id}}">
                <textarea name="comment" placeholder="Write your comment here dummy!" cols="60" rows="7"></textarea> <br>
                <input type="submit" name="Post a comment">
            </form>
            {% else %}
            <h4>Please sign in to comment</h4>
            {% endif %}
          </div>
        </div> 
    </div>
</div>



<script>
  $('#SPPcomment').submit(function(e){
    e.preventDefault()
    $.ajax({
      url: '/add_comment',
      method: 'post',
      data: $(this).serialize(),
      success: function(serverResponse){
        console.log('Comment submitted')
        $('#comments').html(serverResponse)
      }
    })
    $(this).trigger('reset')
  });
</script>


<!-- col-md-6 -->

{% endblock %}